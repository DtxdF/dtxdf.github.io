<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>Install WordPress With Appjail Director | DtxdF</title><meta property="og:site_name" content="Blog"><meta property="og:title" content="Install WordPress With Appjail Director | DtxdF"><meta itemprop=name content="Install WordPress With Appjail Director | DtxdF"><meta name=twitter:title content="Install WordPress With Appjail Director | DtxdF"><meta name=application-name content="Install WordPress With Appjail Director | DtxdF"><meta name=twitter:card content="summary"><meta name=description content="Install WordPress With AppJail Director"><meta name=twitter:description content="Install WordPress With AppJail Director "><meta itemprop=description content=" Install WordPress With AppJail Director "><meta property="og:description" content=" Install WordPress With AppJail Director "><meta property="og:type" content="article"><meta property="article:publisher" content="DtxdF"><meta property="og:article:published_time" content="2023-08-22T15:36:00-0400"><meta property="article:published_time" content="2023-08-22T15:36:00-0400"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Install WordPress With Appjail Director","author":{"@type":"Person","name":"DtxdF"},"datePublished":"2023-08-22","description":"Install WordPress With AppJail Director","wordCount":1208,"mainEntityOfPage":"True","dateModified":"2023-08-22","publisher":{"@type":"Organization","name":"DtxdF","logo":{"@type":"imageObject","url":"https:\/\/dtxdf.github.io\/favicon.ico"}}}</script><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=stylesheet href=/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css></head><script>(function(){const e="ThemeColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="ThemeColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.userColorScheme="dark":document.documentElement.dataset.userColorScheme="light"})()</script><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/><span class=emoji>Blog |</span>
DtxdF</a></div><div class=flex><a href=/articles/>Articles</a>
<button id=dark-mode-button><svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163.0 101.643 1.641 1.163 1.163.0 00-1.643-1.641zm-16.022 14.38a1.74 1.74.0 000 2.465 1.742 1.742.0 100-2.465zm13.968-2.147a2.904 2.904.0 01-4.108.0 2.902 2.902.0 010-4.107 2.902 2.902.0 014.108.0 2.902 2.902.0 010 4.107z" fill="#ffcc4d"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg><svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M16 2s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2V2zm18 14s2 0 2 2-2 2-2 2h-2s-2 0-2-2 2-2 2-2h2zM4 16s2 0 2 2-2 2-2 2H2s-2 0-2-2 2-2 2-2h2zm5.121-8.707s1.414 1.414.0 2.828-2.828.0-2.828.0L4.878 8.708s-1.414-1.414.0-2.829c1.415-1.414 2.829.0 2.829.0l1.414 1.414zm21 21s1.414 1.414.0 2.828-2.828.0-2.828.0l-1.414-1.414s-1.414-1.414.0-2.828 2.828.0 2.828.0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zM16 32s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2v-2z"/><circle fill="#ffd983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>Install WordPress With Appjail Director</h1><div class=post-meta><div>By DtxdF | <time>August 22, 2023</time>
| 6 minutes</div><div class=tags><a href=/tags/wordpress/>wordpress</a>
<a href=/tags/sql/>sql</a>
<a href=/tags/database/>database</a>
<a href=/tags/databases/>databases</a>
<a href=/tags/appjail/>appjail</a>
<a href=/tags/appjail-director/>appjail-director</a>
<a href=/tags/mariadb/>mariadb</a>
<a href=/tags/jail/>jail</a>
<a href=/tags/jails/>jails</a>
<a href=/tags/freebsd/>freebsd</a>
<a href=/tags/container/>container</a>
<a href=/tags/containers/>containers</a></div></div></div></div></header></article><div class=article-post><h2 id=what-are-appjail-and-appjail-director><a href=#what-are-appjail-and-appjail-director class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>What Are AppJail and AppJail Director?</h2><p><strong>AppJail</strong> is a framework that provides preconfigured and self-contained applications, frameworks and software stacks, such as WordPress. Using this tool we will have a package installed inside a jail, a lightweight and isolated environment with any custom configuration our software needs. <a href=https://github.com/DtxdF/AppJail>See also</a>.</p><p><strong>AppJail Director</strong> is an complementary tool that help us link individual jails so they can work together using an easy-to-learn YAML file. <a href=https://github.com/DtxdF/director>See also</a>.</p><p>Although an optional feature, AppJail has images, a static snapshot of a jail that improves performance by only downloading the image and importing it when needed. Once an image is downloaded, it is cached until the maintainer of that image updates it. Almost all images in the <a href=https://github.com/AppJail-makejails>centralized repository</a> take advantage of this feature.</p><h2 id=why-use-appjail-director-to-run-wordpress><a href=#why-use-appjail-director-to-run-wordpress class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Why Use AppJail Director to Run WordPress?</h2><p>You can simply use AppJail to install WordPress and its dependencies, such as MariaDB, but the benefit of using AppJail Director is that you have a single YAML file, which is easy for humans to read. Using this single file we can share volumes and options between jails in a much easier way. Updating them is another benefit as AppJail Director detects when you change a parameter in the file.</p><p>AppJail Director is not a replacement for AppJail, it is just a tool to create and destroy ephemeral jails in a convenient way.</p><p><strong>Note</strong>: When using ZFS, AppJail Director will recursively remove the dataset and its references from a jail. Use a copy instead of a snapshot when using AppJail Director.</p><h3 id=dns><a href=#dns class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>DNS</h3><p>The following configuration assumes that you are using DNS. DNS is useful in these cases because we don&rsquo;t need to set up static IP addresses and remember each one, we just need to follow the convention that each jail has a hostname such as <code>&lt;Jail Name>.&lt;Virtual Network>.&lt;Domain></code>. <code>&lt;Domain></code> is <code>.appjail</code> unless you have changed it and <code>&lt;Virtual Network></code> is <code>ajnet</code> unless you have changed it.</p><p>See <a href=https://github.com/DtxdF/AppJail#dns>AppJail#DNS</a> for details.</p><h3 id=set-up-wordpress><a href=#set-up-wordpress class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Set Up WordPress</h3><ol><li><p>Create a new directory named <code>./wordpress/</code> and <code>cd</code> into it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mkdir -p ./wordpress/
</span></span><span class=line><span class=cl><span class=nb>cd</span> ./wordpress/
</span></span></code></pre></td></tr></table></div></div></li><li><p>Create a file named <code>appjail-director.yml</code> in this folder and add the following contents. Set your passwords for the <code>wp_db_password</code>, <code>mariadb_root_password</code>, and <code>mariadb_password</code> arguments. The password entered for <code>wp_db_password</code> and <code>mariadb_password</code> should be the same.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>options</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>virtualnet</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;:&lt;random&gt; default&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>nat</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>wordpress</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>makejail</span><span class=p>:</span><span class=w> </span><span class=l>gh+AppJail-makejails/wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>options</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>expose</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>arguments</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>wp_db_name</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>wp_db_user</span><span class=p>:</span><span class=w> </span><span class=l>wpuser</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>wp_db_password</span><span class=p>:</span><span class=w> </span><span class=m>123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>wp_db_host</span><span class=p>:</span><span class=w> </span><span class=l>mariadb.ajnet.appjail</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mariadb</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>makejail</span><span class=p>:</span><span class=w> </span><span class=l>gh+AppJail-makejails/mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>arguments</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>mariadb_user</span><span class=p>:</span><span class=w> </span><span class=l>wpuser</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>mariadb_password</span><span class=p>:</span><span class=w> </span><span class=m>123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>mariadb_database</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>mariadb_root_password</span><span class=p>:</span><span class=w> </span><span class=m>321</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Start your jails:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> appjail-director up -p wordpress
</span></span><span class=line><span class=cl><span class=go>Starting Director; project ID: wordpress; logs: /root/.local/pipx/venvs/director/director/logs/wordpress/2023-08-23_05h44m11s;
</span></span></span><span class=line><span class=cl><span class=go>Creating wordpress (wordpress) ... Done.
</span></span></span><span class=line><span class=cl><span class=go>Creating mariadb (mariadb) ... Done.
</span></span></span><span class=line><span class=cl><span class=go>Finished: wordpress
</span></span></span></code></pre></td></tr></table></div></div><p><strong>Note</strong>: Using the <code>-p</code> parameter we can set the name of our project, so we can track the jails using this name.</p><p>We already have WordPress installed, you just have to set up your admin username and password in the web interface.</p></li><li><p>Volumes (optional, but recommended): We can use WordPress as a bare metal installation and it only took us a few minutes. Now we can add volumes to our WordPress installation, why?:</p><ul><li>Having a separate directory for our data is much easier to move to, for example, an SSD. The rest of the data can remain on the HDD.</li><li>Much easier to make backups of the data. Jails in AppJail are treated as ephemeral, not literally, you can stop the jail or reboot your system and the jails will be there anyway, but what I mean by ephemeral is that you can destroy your jail and as you separate the data you have a new updated services but with the old data.</li></ul><p>Why not just use volumes the first time? Remember that <code>nullfs(5)</code> is the default volume type as it is used to mount one directory into another, so if we mount an empty directory our jail will have an empty directory as the last directory is stacked in the old directory. We could use <code>mount_unionfs(8)</code> but as its man page says:</p><pre tabindex=0><code>THIS FILE SYSTEM TYPE IS NOT YET FULLY SUPPORTED (READ: IT DOESN&#39;T WORK)
AND USING IT MAY, IN FACT, DESTROY DATA ON YOUR SYSTEM.  USE AT YOUR OWN
RISK.
</code></pre><p>Our plan is as follows: 1. stop the jails so that their services do not write data until we migrate the data from the jail to the host. 2. copy or move the data from the jail to the host. 3. configure <code>appjail-director.yml</code> to use volumes. 4. re-run the jails.</p></li><li><p>Stop the jails:</p><pre tabindex=0><code># appjail-director ls -p wordpress
wordpress:
+ wordpress (wordpress)
+ mariadb (mariadb)
# appjail-director down -p wordpress
Starting Director; project ID: wordpress; logs: /root/.local/pipx/venvs/director/director/logs/wordpress/2023-08-23_06h15m11s;
Stopping wordpress ... Done.
Stopping mariadb ... Done.
# appjail-director ls -p wordpress
wordpress:
- wordpress (wordpress)
- mariadb (mariadb)
</code></pre></li><li><p>Copy or move the data from the jail to the host:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> mkdir -p ./mariadb/db/
</span></span><span class=line><span class=cl><span class=gp>#</span> mkdir -p ./mariadb/done/
</span></span><span class=line><span class=cl><span class=gp>#</span> mkdir -p ./wordpress/wp-content/
</span></span><span class=line><span class=cl><span class=gp>#</span> chown -f 88:88 ./mariadb/db/
</span></span><span class=line><span class=cl><span class=gp>#</span> chown www:www ./wordpress/wp-content/
</span></span><span class=line><span class=cl><span class=gp>#</span> appjail cmd <span class=nb>local</span> wordpress sh -c <span class=s2>&#34;mv usr/local/www/apache24/data/wp-content/* </span><span class=nv>$PWD</span><span class=s2>/wordpress/wp-content&#34;</span>
</span></span><span class=line><span class=cl><span class=gp>#</span> ls ./wordpress/wp-content/
</span></span><span class=line><span class=cl><span class=go>index.php       languages       plugins         themes          upgrade
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>#</span> appjail cmd <span class=nb>local</span> mariadb sh -c <span class=s2>&#34;mv var/db/mysql/* </span><span class=nv>$PWD</span><span class=s2>/mariadb/db&#34;</span>
</span></span><span class=line><span class=cl><span class=gp>#</span> ls ./mariadb/db/
</span></span><span class=line><span class=cl><span class=go>aria_log.00000001       ib_buffer_pool          ibdata1                 mysql                   performance_schema      wordpress
</span></span></span><span class=line><span class=cl><span class=go>aria_log_control        ib_logfile0             multi-master.info       mysql_upgrade_info      sys
</span></span></span></code></pre></td></tr></table></div></div><p><strong>Note</strong>: As you can see, <code>chown(8)</code> is used to set permissions. This step is important because <code>mount_nullfs(8)</code> mounts the directories as is.</p></li><li><p>Configure <code>appjail-director.yml</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>options</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>virtualnet</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;:&lt;random&gt; default&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>nat</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>wordpress</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>makejail</span><span class=p>:</span><span class=w> </span><span class=l>gh+AppJail-makejails/wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>options</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>expose</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>arguments</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>wp_db_name</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>wp_db_user</span><span class=p>:</span><span class=w> </span><span class=l>wpuser</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>wp_db_password</span><span class=p>:</span><span class=w> </span><span class=m>123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>wp_db_host</span><span class=p>:</span><span class=w> </span><span class=l>mariadb.ajnet.appjail</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>wp-content</span><span class=p>:</span><span class=w> </span><span class=l>/usr/local/www/apache24/data/wp-content</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mariadb</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>makejail</span><span class=p>:</span><span class=w> </span><span class=l>gh+AppJail-makejails/mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mariadb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>arguments</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>mariadb_user</span><span class=p>:</span><span class=w> </span><span class=l>wpuser</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>mariadb_password</span><span class=p>:</span><span class=w> </span><span class=m>123</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>mariadb_database</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>mariadb_root_password</span><span class=p>:</span><span class=w> </span><span class=m>321</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>db</span><span class=p>:</span><span class=w> </span><span class=l>/var/db/mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>db-done</span><span class=p>:</span><span class=w> </span><span class=l>/.mariadb-done</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>wp-content</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>device</span><span class=p>:</span><span class=w> </span><span class=l>./wordpress/wp-content</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>device</span><span class=p>:</span><span class=w> </span><span class=l>./mariadb/db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db-done</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>device</span><span class=p>:</span><span class=w> </span><span class=l>./mariadb/done</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>options</span><span class=p>:</span><span class=w> </span><span class=l>ro</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>As you can see, there is an empty directory named <code>./mariadb/done/</code>. The purpose of this directory is to tell Makejail scripts not to reconfigure MariaDB. If we reconfigure MariaDB with old databases, the installation will fail because it probably has a password that the scripts do not know.</p></li><li><p>Re-run the jails:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> appjail-director up -p wordpress
</span></span><span class=line><span class=cl><span class=go>Starting Director; project ID: wordpress; logs: /root/.local/pipx/venvs/director/director/logs/wordpress/2023-08-23_13h34m57s;
</span></span></span><span class=line><span class=cl><span class=go>Stopping wordpress ... Done.
</span></span></span><span class=line><span class=cl><span class=go>Destroying wordpress ... Done.
</span></span></span><span class=line><span class=cl><span class=go>Stopping mariadb ... Done.
</span></span></span><span class=line><span class=cl><span class=go>Destroying mariadb ... Done.
</span></span></span><span class=line><span class=cl><span class=go>Creating wordpress (wordpress) ... Done.
</span></span></span><span class=line><span class=cl><span class=go>Creating mariadb (mariadb) ... Done.
</span></span></span><span class=line><span class=cl><span class=go>Finished: wordpress
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=afterword><a href=#afterword class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Afterword</h2><p>As you can see, it&rsquo;s much easier to create jails this way and it only takes a few minutes to deploy a WordPress installation with MariaDB.</p><p>If you find this article or the projects useful, please contribute to them:</p><ul><li><a href=https://liberapay.com/AppJail>Donate to AppJail</a>.</li><li><a href=https://github.com/DtxdF/AppJail/issues/new>Contribute your Makejail</a>.</li><li>Contribute a mirror to put images.</li><li>Fix bugs or improve AppJail.</li></ul></div></div><div class=container><nav class="flex container suggested"><a rel=prev href=/post/python-with-appjail-fastapi/ title="Previous post (older)"><span>Previous</span>
Python With Appjail | FastAPI</a></nav></div><div class=container></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=/index.xml>RSS</a>
<a href="https://underc0de.org/foro/profile/?area=showposts;sa=topics;u=71723">Underc0de</a></nav></section><script defer src=/ts/features.706a523ba43e6d0427c7fdf2b9d05dbd0920d3f12942b453690b495cb2522743.js data-enable-footnotes=true></script></footer></body></html>